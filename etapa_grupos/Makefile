# Makefile for Ant Colony Simulation
# Usage:
#   make 4grupos   - Run simulation for 4 groups (dados_4_grupos.txt)
#   make 15grupos  - Run simulation for 15 groups (dados_15_grupos.txt)
#   make clean     - Clean all generated files

CXX = g++
CXXFLAGS = -std=c++20
SOURCE = simulacao.cpp
EXECUTABLE = simulacao

# ============================================
# CONFIGURA√á√ïES PARA 4 GRUPOS (dados_4_grupos.txt)
# ============================================
PARAMS_4GRUPOS = \
	-DDADOS_FILE='"dados_4_grupos.txt"' \
	-DEXP_DECAY=0 \
	-DRAIO_VISAO_START=5 \
	-DRAIO_VISAO_END=2 \
	-DALPHA_START=1.5 \
	-DALPHA_END=1.5 \
	-DK1_START=0.05 \
	-DK1_END=0.05 \
	-DK2_START=0.200 \
	-DK2_END=0.200 \
	-DNORMALIZE=1

# ============================================
# CONFIGURA√á√ïES PARA 15 GRUPOS (dados_15_grupos.txt)
# ============================================
PARAMS_15GRUPOS = \
	-DDADOS_FILE='"dados_15_grupos.txt"' \
	-DEXP_DECAY=0 \
	-DRAIO_VISAO_START=5 \
	-DRAIO_VISAO_END=2 \
	-DALPHA_START=0.1 \
	-DALPHA_END=0.005 \
	-DK1_START=0.010 \
	-DK1_END=0.00050 \
	-DK2_START=0.030 \
	-DK2_END=0.00010 \
	-DNORMALIZE=1

.PHONY: all 4grupos 15grupos clean clean-frames clean-all open-4 open-15

all: 4grupos

# ============================================
# Target for 4 groups simulation
# ============================================
4grupos: clean-frames
	@echo "========================================="
	@echo "   SIMULA√á√ÉO PARA 4 GRUPOS (dados_4_grupos.txt)"
	@echo "========================================="
	@echo "Compilando com as seguintes configura√ß√µes:"
	@echo "  - Arquivo de dados: dados_4_grupos.txt"
	@echo "  - Raio vis√£o: 5 -> 2"
	@echo "  - Alpha: 1.5 -> 1.5"
	@echo "  - K1: 0.05 -> 0.05"
	@echo "  - K2: 0.200 -> 0.200"
	@echo ""
	@$(CXX) $(CXXFLAGS) $(PARAMS_4GRUPOS) $(SOURCE) -o $(EXECUTABLE)
	@echo "Executando simula√ß√£o..."
	@./$(EXECUTABLE)
	@echo ""
	@echo "Gerando v√≠deo out_4grupos.mp4..."
	@$(MAKE) video OUTPUT=out_4grupos.mp4
	@echo ""
	@echo "========================================="
	@echo "‚úÖ CONCLU√çDO! Video: out_4grupos.mp4"
	@echo "========================================="

# ============================================
# Target for 15 groups simulation  
# ============================================
15grupos: clean-frames
	@echo "========================================="
	@echo "  SIMULA√á√ÉO PARA 15 GRUPOS (dados_15_grupos.txt)"
	@echo "========================================="
	@echo "Compilando com as seguintes configura√ß√µes:"
	@echo "  - Arquivo de dados: dados_15_grupos.txt"
	@echo "  - Raio vis√£o: 5 -> 2"
	@echo "  - Alpha: 0.1 -> 0.005"
	@echo "  - K1: 0.010 -> 0.00050"
	@echo "  - K2: 0.030 -> 0.00010"
	@echo ""
	@$(CXX) $(CXXFLAGS) $(PARAMS_15GRUPOS) $(SOURCE) -o $(EXECUTABLE)
	@echo "Executando simula√ß√£o..."
	@./$(EXECUTABLE)
	@echo ""
	@echo "Gerando v√≠deo out_15grupos.mp4..."
	@$(MAKE) video OUTPUT=out_15grupos.mp4
	@echo ""
	@echo "========================================="
	@echo "‚úÖ CONCLU√çDO! Video: out_15grupos.mp4"
	@echo "========================================="

# ============================================
# Generate video from frames
# ============================================
video:
	@ffmpeg -y -framerate 20 -i frames/frame_%05d.ppm -vf scale=640:640 -c:v libx264 -pix_fmt yuv420p $(OUTPUT) 2>/dev/null || \
	(echo "‚ùå Erro ao gerar v√≠deo. Verifique se o ffmpeg est√° instalado." && exit 1)

# ============================================
# Open videos (macOS)
# ============================================
open-4:
	@if [ -f out_4grupos.mp4 ]; then \
		open out_4grupos.mp4; \
	else \
		echo "‚ùå Arquivo out_4grupos.mp4 n√£o encontrado. Execute 'make 4grupos' primeiro."; \
	fi

open-15:
	@if [ -f out_15grupos.mp4 ]; then \
		open out_15grupos.mp4; \
	else \
		echo "‚ùå Arquivo out_15grupos.mp4 n√£o encontrado. Execute 'make 15grupos' primeiro."; \
	fi

# ============================================
# Clean targets
# ============================================
clean-frames:
	@rm -rf frames/
	@mkdir -p frames/

clean:
	@rm -f $(EXECUTABLE) *.tmp
	@rm -f out_4grupos.mp4 out_15grupos.mp4
	@echo "üßπ Arquivos limpos!"

clean-all: clean clean-frames
	@echo "üßπ Todos os arquivos gerados foram removidos!"

# ============================================
# Help
# ============================================
help:
	@echo "Comandos dispon√≠veis:"
	@echo "  make 4grupos   - Executa simula√ß√£o para 4 grupos"
	@echo "  make 15grupos  - Executa simula√ß√£o para 15 grupos"
	@echo "  make open-4    - Abre v√≠deo de 4 grupos"
	@echo "  make open-15   - Abre v√≠deo de 15 grupos"
	@echo "  make clean     - Remove execut√°veis e v√≠deos"
	@echo "  make clean-all - Remove tudo (incluindo frames)"
	@echo "  make help      - Mostra esta mensagem"